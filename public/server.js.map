{"version":3,"file":"server.js","sources":["../node_modules/micro-events/index.js","server/model/user.js","server/model/area.js","server/model/item.js","server/model/character.js","server/model/monster.js","server/model/place.js","server/model/map.js","server/model/game.js","server/app.js","server.js"],"sourcesContent":["function _each(arr, func, thisArg) {\n    for (var i = 0; i < arr.length; i++) {\n        func.call(thisArg, arr[i]);\n    }\n}\n\nfunction _remove(arr, element) {\n    var index = arr.indexOf(element);\n    if (index !== -1) {\n        arr.splice(index, 1);\n    }\n}\n\nfunction _contains(arr, element) {\n    return arr.indexOf(element) !== -1;\n}\n\nfunction EventEmitter() {\n    this.listeners = {};\n}\n\nEventEmitter.prototype.maxListeners = 10;\n\nfunction _validateEventName(eventName) {\n    if (typeof eventName !== 'string') {\n        throw 'eventName is not a string';\n    }\n}\n\nfunction _validateListener(listener) {\n    if (typeof listener !== 'function') {\n        throw 'listener is not a function';\n    }\n}\n\nEventEmitter.prototype.on = function (eventName, listener) {\n    _validateEventName(eventName);\n    _validateListener(listener);\n    this.listeners[eventName] = this.listeners[eventName] || [];\n    if (this.listeners[eventName].length > this.maxListeners) {\n        throw 'Exceeded maxListeners - You might have a memory leak';\n    }\n    if (!_contains(this.listeners[eventName], listener)) {\n        this.listeners[eventName].push(listener);\n        this.emit('on', {\n            eventName: eventName,\n            listener: listener\n        });\n    }\n    return this;\n};\n\nEventEmitter.prototype.emit = function (eventName, event) {\n    _validateEventName(eventName);\n    var events = Array.prototype.slice.call(arguments, 1);\n    _each(this.listeners[eventName] || [], function (listener) {\n        listener.apply(this, events);\n    }, this);\n    return this;\n};\n\nEventEmitter.prototype.off = function (eventName, listener) {\n    _validateEventName(eventName);\n    _validateListener(listener);\n    _remove(this.listeners[eventName] || [], listener);\n\n    this.emit('off', {\n        eventName: eventName,\n        listener: listener\n    });\n    return this;\n};\n\nEventEmitter.prototype.clearListeners = function (eventName) {\n    _validateEventName(eventName);\n    this.listeners[eventName] = null;\n    return this;\n};\n\nmodule.exports = EventEmitter;\n","/**\r\n * User session class\r\n * @param {Socket} socket\r\n\r\n  status:\r\n\t0: standby\r\n\t1: ingame\r\n */\r\nclass User {\r\n\tconstructor(socket){\r\n\t\tthis.id = socket.id;\r\n\t\tthis.socket = socket;\r\n\t\tthis.info = {\r\n\t\t\tid: this.id,\r\n      name: 'player',\r\n      hair: 0,\r\n      skin: 0,\r\n\t\t\tstatus: 0,\r\n\t\t\tgame: null\r\n    };\r\n\t}\r\n\r\n\tupdateInfo(info){\r\n\t\t//console.log('updating info', this.id,  info)\r\n    if(info.name) this.info.name = info.name\r\n    if(info.hair > -1) this.info.hair = info.hair\r\n    if(info.skin > -1) this.info.skin = info.skin\r\n\t\tif(info.status) this.info.status = info.status\r\n\r\n\t\tthis.updateUser()\r\n  }\r\n\r\n\tupdateUser(){\r\n\t\tthis.socket.nsp.to(this.socket.id).emit('updateInfo', this.info)\r\n\t}\r\n}\r\n\r\nexport default User;\r\n","\r\nclass Area {\r\n  constructor(map_size){\r\n    let area = random(MAPS.areas, 3)\r\n    this.id = area[0]\r\n    this.x= getRandom(1, map_size - area[3] - 1)\r\n    this.y= getRandom(1, map_size - area[3] - 1)\r\n    this.w= getRandom(area[2], area[3])\r\n    this.h= getRandom(area[2], area[3])\r\n  }\r\n\r\n  getRndPt(){\r\n    return {\r\n      x:ã€€getRandom(this.x, this.r()),\r\n      y: getRandom(this.y, this.b())\r\n    }\r\n  }\r\n\r\n  mid(){\r\n    return {\r\n      x: this.x + (this.w/2),\r\n      y: this.y + (this.h/2)\r\n    }\r\n  }\r\n\r\n  r(){\r\n    return this.x + this.w\r\n  }\r\n\r\n  b(){\r\n    return this.y + this.h\r\n  }\r\n}\r\n\r\nexport default Area;\r\n","class Item{\r\n    constructor(id, luk = 3, epv = 10){\r\n      this.item = ITEMS.data[id]\r\n      this.name = id\r\n      this.eq = false\r\n      this.pos = this.item.pos\r\n      this.grade = this.getGrade(luk, epv)\r\n      this.obj = this.item.obj + this.grade;\r\n      this.bonus = this.item.factor * this.grade;\r\n    }\r\n\r\n    attr(key){\r\n      return this.item.attrs[key] ? this.item.attrs[key] > 0 ? this.item.attrs[key] + this.bonus : this.item.attrs[key] :0\r\n    }\r\n\r\n    getGrade(luk, epv){\r\n      let grade = 1;\r\n      let min, max\r\n      switch (true) {\r\n        case (epv < 20):\r\n          min = 1000;\r\n          max = 2999;\r\n          break;\r\n        case (epv >= 20 && epv < 40):\r\n          min = 2000;\r\n          max = 4999;\r\n          break;\r\n        case (epv >= 40 && epv < 60):\r\n          min = 4000;\r\n          max = 6500;\r\n          break;\r\n        case (epv >= 60):\r\n          min = 5000;\r\n          max = 6999;\r\n      }\r\n\r\n      return ~~((getRandom(min, max) + (luk * 50)) / 1000) - 1;\r\n    }\r\n}\r\n\r\nexport default Item;\r\n","import Item from './item';\r\nclass Character{\r\n  constructor(user, time = 0, id = -1){\r\n    this.id = id\r\n    this.status = {\r\n      nextTime: time,\r\n      rdy: false,\r\n      attrs: {\r\n        hp: 100,\r\n        atk: getRandom(7,10),\r\n        def: getRandom(2,5),\r\n        spd: 4,\r\n        luk: getRandom(3,4),\r\n      },\r\n      place: null,\r\n      items: ['map', new Item('hemlet', 0, 10), new Item('armor', 0, 10), new Item('axe', 0, 10)],\r\n      loc: { x: -1, y: -1},\r\n    }\r\n\r\n    this.info = {\r\n      skin: user.info.skin,\r\n      hair: user.info.hair,\r\n      name: user.info.name\r\n    }\r\n  }\r\n\r\n  attr(){\r\n    return this.status.items.reduce((attrs, item)=> {\r\n      if(typeof item === 'string') return attrs;\r\n      let data = Object.assign({}, attrs)\r\n      if(item.eq){\r\n        Object.keys(this.status.attrs).forEach(atr=> {\r\n          data[atr] = data[atr] + item.attr(atr)\r\n        })\r\n      }\r\n      return data;\r\n    }, this.status.attrs)\r\n  }\r\n\r\n  atk(p, cb){\r\n    //calculate damage\r\n    //critical token\r\n    let crit = getRandom(1,25) < this.attr().luk\r\n    let dmg = ~~(this.attr().atk + getRandom(1,5) - p.attr().def)\r\n\r\n    p.status.attrs.hp = p.status.attrs.hp - dmg;\r\n\r\n    cb(p, this)\r\n  }\r\n}\r\n\r\nexport default Character;\r\n","import Character from './character';\r\n class Monster extends Character {\r\n  constructor(epv = 10, type = 0){\r\n    //type 0 orc\r\n    super({\r\n      info:{\r\n        name: 'Monster',\r\n        skin: 5,\r\n        hair: 4\r\n      }\r\n    })\r\n\r\n    this.status.items.forEach(i=>{\r\n      if(typeof i !== 'string') i.eq = true\r\n    })\r\n  }\r\n}\r\n\r\nexport default Monster;\r\n","import Monster from './monster';\r\n\r\nclass Place {\r\n  constructor(type, name, x=-1, y=-1){\r\n    //console.log(type)\r\n    this.name = name || type[1]\r\n    this.type = type || random(MAPS.areas)\r\n    this.x = x;\r\n    this.y = y;\r\n    this.monsters = [new Monster()]\r\n    this.env = {\r\n      back: random(this.type[7][0]),\r\n      bottom: random(this.type[7][1]),\r\n      backEls: this.genBackEls(4)\r\n    }\r\n  }\r\n\r\n  genBackEls(x){\r\n    let objs = []\r\n\r\n    for(let i = 0; i < x; i++){\r\n      objs.push(random(this.type[7][2]))\r\n    }\r\n\r\n    return objs\r\n  }\r\n}\r\n\r\nexport default Place;\r\n","\r\nimport Area from './area';\r\nimport Place from './place';\r\n\r\nclass Map {\r\n  constructor(size = 64){\r\n    this.map = null;\r\n    this.map_size = size\r\n    this.areas = []\r\n    this.places = []\r\n    this.types = {}\r\n  }\r\n\r\n  generate(){\r\n    this.map = []\r\n\r\n    //console.log('world-init maps')\r\n    for (let x = 0; x < this.map_size; x++) {\r\n      this.map[x] = []\r\n      for( let y = 0; y < this.map_size; y++) {\r\n        this.map[x][y] = 0;\r\n      }\r\n    }\r\n\r\n    let room_count = getRandom(10, 30);\r\n\r\n    //console.log('world-creating areas')\r\n    for(let i = 0; i < room_count; i++){\r\n      let area = new Area(this.map_size)\r\n\r\n      if(this.isCollide(area)) {\r\n        i--;\r\n        continue;\r\n      }\r\n\r\n      area.w--;\r\n      area.h--;\r\n\r\n      this.areas.push(area);\r\n    }\r\n\r\n    //console.log('world-squash areas')\r\n    //this.squashRooms();\r\n\r\n    //find path\r\n    //console.log('world-make paths')\r\n    this.areas.forEach( areaA => {\r\n      let areaB = this.closestRoom(areaA)\r\n      //console.log('world-pass close area', areaB)\r\n      let ptA = areaA.getRndPt()\r\n      let ptB = areaB.getRndPt()\r\n      //console.log( 'rd pts', ptA, ptB)\r\n      while( (ptB.x != ptA.x) || (ptB.y != ptA.y) ){\r\n          if(ptB.x != ptA.x){\r\n            if (ptB.x > ptA.x) ptB.x--\r\n            else ptB.x++\r\n          }else if(ptB.y != ptA.y){\r\n            if(ptB.y > ptA.y) ptB.y--\r\n            else ptB.y++\r\n          }\r\n\r\n          this.map[ptB.x][ptB.y] = 1;\r\n      }\r\n    })\r\n\r\n    //console.log('world-fill rooms')\r\n    //set room to 1\r\n    this.areas.forEach( area=>{\r\n      for(let x = area.x; x < area.r(); x++) {\r\n        for(let y = area.y; y < area.b(); y++) {\r\n          this.map[x][y] = area.id;\r\n        }\r\n      }\r\n    })\r\n\r\n    //console.log('world-build sand')\r\n    //make america great again\r\n    for( let x = 0; x < this.map_size; x++){\r\n      for( let y = 0; y < this.map_size; y++){\r\n        if(this.map[x][y] == 1){\r\n          for( let _x = x-1; _x <=x + 1; _x++){\r\n            for( let _y = y-1; _y<=y+1; _y++){\r\n              if(this.map[_x][_y] == 0) this.map[_x][_y] = 2\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    //generate places\r\n    for (let x = 0; x < this.map_size; x++) {\r\n      this.places[x] = []\r\n      for( let y = 0; y < this.map_size; y++) {\r\n        this.places[x][y] = new Place(MAPS.areas[this.map[x][y]], null, x, y);\r\n        if(!this.types[this.map[x][y]]){\r\n          this.types[this.map[x][y]] = [this.places[x][y]]\r\n        }else{\r\n          this.types[this.map[x][y]].push(this.places[x][y])\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  closestRoom(area) {\r\n    let ptM = area.mid()\r\n\r\n    let closet = null;\r\n    let closetDst = 1000;\r\n\r\n    this.areas.forEach( _area => {\r\n      if(_area == area) return;\r\n      let checkPtM = _area.mid();\r\n      let dst = Math.abs(ptM.x - checkPtM.x) + Math.abs(ptM.y - checkPtM.y)\r\n      if(dst < closetDst) {\r\n        closetDst = dst\r\n        closet = _area\r\n      }\r\n    })\r\n\r\n    return closet\r\n  }\r\n\r\n  // squashRooms(){\r\n  //   for(let i = 0; i < 10; i++) {\r\n  //     this.areas.forEach( (area, j)=>{\r\n  //       while(true){\r\n  //         let ptOld = {\r\n  //           x: area.x,\r\n  //           y: area.y\r\n  //         }\r\n  //         if( area.x > 1) area.x--;\r\n  //         if( area.y > 1) area.y--;\r\n  //         if( (area.x == 1) && (area.y ==1) ) break;\r\n  //         if( this.isCollide(area, j) ) {\r\n  //           area.x = ptOld.x\r\n  //           area.y = ptOld.y\r\n  //           break;\r\n  //         }\r\n  //       }\r\n  //     })\r\n  //   }\r\n  // }\r\n\r\n  isCollide(area, ignore){\r\n    for(let i = 0; i < this.areas.length; i++){\r\n      if( i == ignore) continue;\r\n      let check = this.areas[i]\r\n\r\n      if(!(\r\n        (area.r() < check.x) ||\r\n        (area.x > check.b()) ||\r\n        (area.b() < check.y) ||\r\n        (area.y > check.r())\r\n      )) return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default Map\r\n","import Map from './map';\r\nimport Place from './place';\r\nimport Item from './item';\r\nimport Character from './character';\r\n/*\r\n  game status = {\r\n    0: open\r\n    1: starting\r\n    2: playing\r\n    3: end\r\n  }\r\n*/\r\nconsole.log('maps', MAPS)\r\nconsole.log('items', ITEMS.data)\r\n\r\n\r\nclass Game {\r\n  constructor(emmiter, id){\r\n    this.map = new Map();\r\n    this.id = id;\r\n    this.maxPlayers = 4;\r\n    this.events = emmiter;\r\n    this.players = {}\r\n    this.status = 0;\r\n    this.logs = []\r\n    this.socket = null\r\n    this.time = 0\r\n    this.countdown = 5\r\n    this.actions = {\r\n      map: {\r\n        req: p=> p.status.items.indexOf('map') > -1\r\n      },\r\n      ready: {\r\n        req: p=> !p.status.rdy,\r\n        act: pid=> {\r\n          this.players[pid].status.rdy = true\r\n          this.log(`${this.players[pid]['info'].name} is ready`)\r\n          this.changeActions(pid)\r\n        }\r\n      },\r\n      'go left': {\r\n        req: p=> p.status.nextTime < this.time && p.status.loc.y > 0,\r\n        act: pid=> this.changePlace(pid, this.players[pid], {y: this.players[pid].status.loc.y - 1})\r\n      },\r\n      'go right': {\r\n        req: p=> p.status.nextTime < this.time && p.status.loc.y >= 0 && p.status.loc.y < 64 ,\r\n        act: pid=> this.changePlace(pid, this.players[pid], {y: this.players[pid].status.loc.y + 1})\r\n      },\r\n      'go up': {\r\n        req: p=> p.status.nextTime < this.time && p.status.loc.x > 0,\r\n        act: pid=> this.changePlace(pid, this.players[pid], {x: this.players[pid].status.loc.x - 1})\r\n      },\r\n      'go down': {\r\n        req: p=> p.status.nextTime < this.time && p.status.loc.x >= 0 && p.status.loc.x < 64 ,\r\n        act: pid=> this.changePlace(pid, this.players[pid], {x: this.players[pid].status.loc.x + 1})\r\n      },\r\n      atk: {\r\n        req: p=> p.status.nextTime < this.time,\r\n        act: pid=> {\r\n\r\n        }\r\n      }\r\n    }\r\n    //generate map\r\n    this.map.generate()\r\n    //generate lobby\r\n    this.lobby = new Place(null, 'game lobby')\r\n    this.log(`Game ${id} created. `)\r\n    this.events.on('remove-user', user => this.removePlayer(user.id))\r\n\r\n    this.timer = setInterval(()=>this.tick(), 1000)\r\n  }\r\n\r\n  changeActions(id){\r\n    if(!(id in this.players))return;\r\n    this.comm('changeActions', Object.keys(this.actions).map(act=> {\r\n      if(this.actions[act].req(this.players[id])) return act;\r\n    }).filter(i=>i), id)\r\n  }\r\n\r\n  getMap() {\r\n    return this.map.map\r\n  }\r\n\r\n  log(msg) {\r\n    console.log(this.id+':'+msg)\r\n    this.logs.push(msg)\r\n    this.comm('gamemsg', this.logs)\r\n  }\r\n\r\n  tick() {\r\n    this.time++\r\n\r\n    if(this.status === 0){\r\n      switch (this.time) {\r\n        case 6:\r\n          this.log('all players will be automatically ready in 10 seconds')\r\n          break;\r\n        case 11:\r\n          this.eachPlayer(p=>p.status.rdy = true)\r\n          break;\r\n      }\r\n    }\r\n\r\n    if(this.status === 0 && !Object.keys(this.players).find(p=>!this.players[p].status.rdy)){\r\n      this.status = 1;\r\n    }\r\n\r\n    //starting game\r\n    if(this.status === 1){\r\n      this.log('Game will start in ' + this.countdown);\r\n      this.countdown--;\r\n      if(this.countdown === 0) this.startGame();\r\n    }\r\n\r\n    if(this.status === 2){\r\n      //in game logics\r\n\r\n\r\n      //only act within player\r\n      this.eachPlayer((p,pid)=>{\r\n\r\n        //make monster atk players\r\n        p.status.place.monsters.forEach(m=>{\r\n          this.ai(m, p)\r\n        })\r\n\r\n        //update available actions\r\n        this.changeActions(pid)\r\n      })\r\n    }\r\n\r\n    this.comm('gameinfo', {time: this.time})\r\n  }\r\n\r\n  ai(monster, player, cb){\r\n    //check monster is actable\r\n    if(monster.status.nextTime > this.time) return;\r\n    //atk the player\r\n    monster.atk(player, (p, m)=>{\r\n      //console.log(p, p.status.attrs)\r\n      monster.status.nextTime = this.time + monster.attr().spd\r\n\r\n      if(p.status.attrs.hp <= 0) this.death(p, m);\r\n      else {\r\n        this.changeAttr(p.id, p)\r\n      }\r\n    })\r\n  }\r\n\r\n  death(p, by){\r\n    //end game for player\r\n    this.log(`${p.info.name} is killed by ${by.info.name}`);\r\n    this.removePlayer(p.id);\r\n\r\n    this.comm('gg', `Game Over! You are killed by ${by.info.name}`)\r\n  }\r\n\r\n  eachPlayer(cb){\r\n    Object.keys(this.players).forEach(pid=>{\r\n      cb(this.players[pid], pid)\r\n    })\r\n  }\r\n\r\n  comm(e, m, id){\r\n    if(this.socket) this.socket.to(id || this.id).emit(e, m)\r\n  }\r\n\r\n  changePlace(pid, p, loc){\r\n    Object.assign(p.status.loc, loc)\r\n    p.status.place = this.map.places[p.status.loc.x][p.status.loc.y]\r\n\r\n    this.comm('changeStage', {\r\n      loc: p.status.loc,\r\n      place: p.status.place\r\n    }, pid)\r\n\r\n    this.changeActions(pid)\r\n  }\r\n\r\n  startGame(){\r\n    //set new point for each player\r\n    this.status = 2\r\n    this.comm('gameinfo', {status: this.status})\r\n    this.log('Game has started')\r\n\r\n    this.eachPlayer((p, pid)=>{\r\n      let loc = random(this.map.areas).getRndPt()\r\n      this.changePlace(pid, p, loc)\r\n    })\r\n  }\r\n\r\n  initGame(id){\r\n    this.socket.to(id).emit('initGame', {\r\n      id: this.id,\r\n      status:ã€€this.status,\r\n      lobby:ã€€this.lobby,\r\n      logs: this.logs,\r\n      time: this.time,\r\n      players: Object.keys(this.players).map(i=>{\r\n        return {\r\n          id: i,\r\n          info:this.players[i].info,\r\n          status: this.players[i].status\r\n        }\r\n      }),\r\n      map: this.getMap()\r\n    })\r\n  }\r\n\r\n  updatePlayers() {\r\n    this.comm('changePlayers', Object.keys(this.players).map(i=>{\r\n      return {\r\n        id: i,\r\n        info:this.players[i].info,\r\n        status: this.players[i].status\r\n      }\r\n    }))\r\n  }\r\n\r\n  addPlayer(user) {\r\n    //this.log(`game ${this.id} add user`, user.id);\r\n    if(!this.socket) this.socket = user.socket.nsp\r\n\r\n    this.players[user.id] = new Character(user, this.time, user.id)\r\n\r\n    user.socket.join(this.id,()=> {\r\n      this.log(`Player ${user.info.name} join the game.`);\r\n    });\r\n\r\n    user.socket.on('gamemsg',msg=> {\r\n      this.log(`${user.info.name}:${msg}`)\r\n    })\r\n\r\n    user.socket.on('gameaction', act=>{\r\n      this.players[user.id].status.nextTime = this.time + (8 - this.players[user.id].attr().spd)\r\n      if(typeof act === 'object'){\r\n        this.actions[act.id].act(user.id, act)\r\n      }else{\r\n        this.actions[act].act(user.id)\r\n      }\r\n    })\r\n\r\n    user.socket.on('useitem', key=>{\r\n      let item = this.players[user.id].status.items[key]\r\n      if(typeof item  === 'string') return;\r\n      if(item.eq) item.eq = false\r\n      else {\r\n        //set everything else to false\r\n        this.players[user.id].status.items.filter(i=>typeof i !== 'string').forEach(i=> {\r\n          if(i.pos === item.pos) i.eq = false\r\n        })\r\n        item.eq = true\r\n      }\r\n\r\n      this.updatePlayers()\r\n      this.changeAttr(user.id, this.players[user.id])\r\n      this.changeItems(user.id, this.players[user.id])\r\n    })\r\n\r\n    user.updateInfo({ status: 1})\r\n\r\n    this.initGame(user.id)\r\n    this.changeActions(user.id)\r\n    this.updatePlayers()\r\n    this.changeAttr(user.id, this.players[user.id])\r\n    this.changeItems(user.id, this.players[user.id])\r\n    //if full squad\r\n    if(this.full()){\r\n      this.status = 1\r\n    }\r\n\r\n  }\r\n\r\n  changeAttr(pid, p){\r\n    this.comm('changeAttr', p.attr(), pid)\r\n  }\r\n\r\n  changeItems(pid, p){\r\n    this.comm('changeItems', p.status.items, pid)\r\n  }\r\n\r\n  removePlayer(uid) {\r\n    if(uid in this.players) {\r\n      this.log(`Removed ${this.players[uid].info.name} from game`);\r\n      delete this.players[uid];\r\n\r\n    }\r\n\r\n    //close game before cron jobs remove\r\n    if(this.empty()) {\r\n       this.status = 3;\r\n    }else{\r\n      this.updatePlayers()\r\n    }\r\n  }\r\n\r\n  full() {\r\n    return Object.keys(this.players).length >= this.maxPlayers\r\n  }\r\n  empty(){\r\n    return Object.keys(this.players).length === 0;\r\n  }\r\n  end(){\r\n    clearInterval(this.timer)\r\n  }\r\n}\r\n\r\nexport default Game;\r\n","import EventEmitter from 'micro-events';\r\nimport User from './model/user';\r\nimport Game from './model/game';\r\n\r\nclass ServerApp {\r\n\tconstructor(){\r\n\t\tthis.events = new EventEmitter();\r\n\t\tthis.events.maxListeners = 999;\r\n\t\tthis.users = []\r\n\t\tthis.games = []\r\n\r\n\t\tsetInterval(this.crons.bind(this), 5000)\r\n\t}\r\n\r\n\tcrons(){\r\n\t\t//status\r\n\t\t\t//console.log('online users', this.users)\r\n\t\t\t//console.log('online games', this.games)\r\n\r\n\t\t//remove empty games\r\n\t\tthis.games.forEach( game=> {\r\n\t\t\tif(game.empty()) this.removeGame(game)\r\n\t\t})\r\n\r\n\t\t//check all open games and start them\r\n\r\n\r\n\t}\r\n\r\n\tcreateNewGame(user, id=uuid()){\r\n\t\tlet game = new Game(this.events, id);\r\n\t\tgame.addPlayer(user);\r\n\t\tthis.addGame(game);\r\n\t\t//user.socket.nsp.to(room).emit('map', game.getMap());\r\n\r\n\t\treturn id;\r\n\t}\r\n\r\n\tqueueGame(user){\r\n\t\tif(this.noGames()){\r\n\t\t\tthis.createNewGame(user)\r\n\r\n\t\t}else{\r\n\t\t\t//join existing game\r\n\t\t\tlet openGames = this.openGames()\r\n\t\t\topenGames[0].addPlayer(user)\r\n\t\t}\r\n\t}\r\n\r\n\tnoGames(){\r\n\t\treturn this.openGames().length === 0\r\n\t}\r\n\r\n\topenGames(){\r\n\t\treturn this.games.filter(g=>g.status == 0)\r\n\t}\r\n\r\n\taddGame(game){\r\n\t\tthis.games.push(game)\r\n\t}\r\n\r\n\tremoveGame(game){\r\n\t\tgame.end()\r\n\t\tconsole.log('remove game: ', game.id)\r\n\t\tthis.games.removeItem(game)\r\n\t}\r\n\r\n\tremoveUser(user){\r\n\t\tthis.users.removeItem(user);\r\n\t\tthis.events.emit('remove-user', user)\r\n\t}\r\n\r\n\taddUser(user){\r\n\t\tthis.users.push(user)\r\n\t}\r\n\r\n\trouter(socket) {\r\n\t\tlet user = new User(socket)\r\n\t\tthis.addUser(user)\r\n\r\n\t\tsocket.on(\"disconnect\", ()=> {\r\n\t\t\tconsole.log(\"Disconnected: \" + socket.id);\r\n\t\t\tthis.removeUser(user)\r\n\t\t});\r\n\r\n\t\tsocket.on('updateInfo', (info, cb)=>{\r\n\t\t\tuser.updateInfo(info)\r\n\t\t\tconsole.log('updated user: ', user.info)\r\n\t\t\tif(cb)cb()\r\n\t\t})\r\n\r\n\t\tsocket.on('queueGame', (req, cb)=> {\r\n\t\t\tthis.queueGame(user)\r\n\t\t\tcb()\r\n\t\t})\r\n\r\n\t\tsocket.on('newgame', ()=> {\r\n\t\t\tif(user.game) {\r\n\t\t\t\treturn console.log('Already in game')\r\n\t\t\t}else{\r\n\t\t\t\tthis.createNewGame('abc123', user)\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tconsole.log(\"Connected: \" + socket.id);\r\n\t\tuser.updateUser()\r\n\t}\r\n}\r\n\r\nexport default ServerApp\r\n","import ServerApp from './server/app'\n\nArray.prototype.removeItem = function(item){\n\treturn this.splice(this.indexOf(item), 1);\n}\n\nconst App = new ServerApp();\nmodule.exports = App.router.bind(App)\n"],"names":["EventEmitter"],"mappings":"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","sourceRoot":"/source/"}